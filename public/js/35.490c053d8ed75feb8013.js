(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{1473:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(0),r=n(49);function s(e,t,n,a,o,i,r){try{var s=e[i](r),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,o)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=n(20),h={name:"list-vehicles",metaInfo:{title:"Lista de vehiculos"},components:{formVehicle:r.a},created:function(){var e=this;this.viewPermissions()||this.$router.push({name:"not-found"}),this.getContracts(this.search).then((function(t){e.totalRows=t}))},data:function(){return{columns:[{label:"Número",field:"number"},{label:"Departamento",field:"department.name"},{label:"Municipio",field:"municipality.name"},{label:"Fecha inicio",field:"start_date"},{label:"Fecha fin",field:"end_date"},{label:"Contratante",field:"contractor.contractor"},{label:"Objeto",field:"object"},{label:"Ingresos",field:"incomes"},{label:"Detalles",field:"details"},{label:"Vehículo",field:"vehicle.car_plate"},{label:"Adicional",field:"aditional"},{label:"Acciones",field:"actions"}],vehicleInEdition:{},totalRows:0,search:{page:1,name:""}}},methods:l(l(l(l({},Object(i.b)("contracts",["getContracts","updateContract","deleteContract"])),Object(i.d)(["CHANGE_SUBMIT_STATUS"])),Object(i.b)("user",["getUsersVehicle"])),{},{showModalEditVehicle:function(e){this.getUsersVehicle(e.vehicle_id),this.vehicleInEdition=clone(e),this.$refs["modal-edit-vehicle"].show()},showModalDeleteVehicle:function(e){var t=this;this.$bvModal.msgBoxConfirm("una vez ejecutada la acción no podra recuperar la información",{title:"¿Está seguro de eliminar el contrato?",size:"sm",buttonSize:"sm",okVariant:"danger",okTitle:"Eliminar",cancelTitle:"NO",footerClass:"p-2",hideHeaderClose:!1,centered:!0}).then((function(n){n&&t.deleteContract(e.id).then((function(e){"vehicle successfully removed"==e&&openNotification("Vehiculo eliminado corrrectamente","Se ha eliminado el Vehiculo")}))}))},save:function(e){var t=this;this.updateContract(e).then((function(e){openNotification(),t.CHANGE_SUBMIT_STATUS(!0),t.$refs["modal-edit-vehicle"].hide()})).catch((function(e){openNotification("Error","No se pudieron guardar los datos","danger"),t.CHANGE_SUBMIT_STATUS(!1)}))},exportData:function(e){return(t=o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get("/api/generate/document/fuec/".concat(e),{responseType:"blob"}).then((function(t){u(t.data,e+"-FUEC.pdf")}));case 2:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function r(e){s(i,a,o,r,c,"next",e)}function c(e){s(i,a,o,r,c,"throw",e)}r(void 0)}))})();var t},viewPermissions:function(){return this.abilities.includes("*")||this.abilities.includes("contratos-listar")},adminPermissions:function(){return this.abilities.includes("*")||this.abilities.includes("contratos-administracion")},onPageChange:function(e){var t=this;this.search.page=e.currentPage,this.getContracts(this.search).then((function(e){t.totalRows=e}))},onSearch:function(e){this.search.name=e.searchTerm}}),computed:l(l({},Object(i.e)("contracts",["contracts"])),Object(i.e)("auth",["abilities"])),watch:{"search.name":function(){var e=this;this.getContracts(this.search).then((function(t){e.totalRows=t}))}}},b=n(2),f=Object(b.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-content"},[n("breadcumb",{attrs:{page:"Lista de contratos",folder:"Contratos"}}),e._v(" "),n("b-card",[n("vue-good-table",{attrs:{rows:e.contracts,columns:e.columns,"line-numbers":!1,"total-rows":e.totalRows,"search-options":{enabled:!0,trigger:"enter",placeholder:"Buscar en esta tabla"},"pagination-options":{enabled:!0,perPage:20,mode:"records"},styleClass:"tableOne vgt-table"},on:{"on-page-change":e.onPageChange,"on-search":e.onSearch},scopedSlots:e._u([{key:"table-row",fn:function(t){return["actions"==t.column.field?n("span",[e.adminPermissions()?n("a",{staticClass:"clickeable",on:{click:function(n){return e.showModalEditVehicle(t.row)}}},[n("i",{staticClass:"i-Eraser-2 text-25 text-success mr-2"}),e._v("\n                "+e._s(t.row.button)+"\n              ")]):e._e(),e._v(" "),e.adminPermissions()?n("a",{staticClass:"clickeable",on:{click:function(n){return e.showModalDeleteVehicle(t.row)}}},[n("i",{staticClass:"i-Close-Window text-25 text-danger"}),e._v("\n                "+e._s(t.row.button)+"\n              ")]):e._e()]):"aditional"==t.column.field?n("span",[n("router-link",{staticClass:"mb-2",attrs:{to:{name:"detalles-contrato",params:{id:t.row.id}},custom:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.href,o=t.navigate;return[n("a",{staticClass:"btn open btn-primary btn-sm",attrs:{href:a},on:{click:o}},[e._v("Rutas")])]}}],null,!0)}),e._v(" "),1==t.row.blocked_license?n("div",{staticClass:"text-danger"},[e._v("\n              El conductor no tiene licencia valida\n            ")]):e._e(),e._v(" "),1==t.row.blocked_documents?n("div",{staticClass:"text-danger"},[e._v("\n              El vehículo no tiene documentos al día\n            ")]):e._e(),e._v(" "),1==t.row.blocked_payment?n("div",{staticClass:"text-danger"},[e._v("\n              Tienes cuentas por pagar\n            ")]):e._e(),e._v(" "),0==t.row.blocked_license&&0==t.row.blocked_documents&&0==t.row.blocked_payment?n("div",[n("b-button",{attrs:{disabled:t.row.routes.length<1,variant:"secondary",size:"sm"},on:{click:function(n){return e.exportData(t.row.id)}}},[e._v("\n                  Descargar Fuec\n              ")]),e._v(" "),t.row.routes.length<1?n("div",{staticClass:"text-danger"},[e._v("\n                  Debes agregar al menos una ruta\n                ")]):e._e()],1):e._e()],1):e._e()]}}])},[n("div",{staticClass:"mb-3",attrs:{slot:"table-actions"},slot:"table-actions"},[e.adminPermissions()?n("router-link",{staticClass:"btn btn-primary btn-rounded d-none d-sm-block",attrs:{tag:"a",to:{name:"nuevo-contrato"}}},[n("i",{staticClass:"i-Add-User text-white mr-2"}),e._v("Crear contrato\n        ")]):e._e()],1)])],1),e._v(" "),n("b-modal",{ref:"modal-edit-vehicle",attrs:{centered:"",size:"lg",title:"Actualizar vehículo","hide-footer":""}},[n("form-vehicle",{attrs:{vehicle:e.vehicleInEdition},on:{save:e.save}})],1)],1)}),[],!1,null,"0f21b282",null);t.default=f.exports},20:function(e,t){e.exports=function(e,t,n,a){var o=new Blob(void 0!==a?[a,e]:[e],{type:n||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var i=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),r=document.createElement("a");r.style.display="none",r.href=i,r.setAttribute("download",t),void 0===r.download&&r.setAttribute("target","_blank"),document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r),window.URL.revokeObjectURL(i)}),200)}}}}]);