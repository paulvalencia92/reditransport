(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{1442:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r(1),s=r.n(i),c=r(4),o=r.n(c);function a(e,t,r,n,i,s,c){try{var o=e[s](c),a=o.value}catch(e){return void r(e)}o.done?t(a):Promise.resolve(a).then(n,i)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d={name:"formLink",props:["idVehicle"],components:{ModelSelect:r(15).ModelSelect},created:function(){this.CLEAR_ERRORS(),this.CHANGE_SUBMIT_STATUS(!1),this.getUsersDoesntHaveVehicle(this.idVehicle)},data:function(){return{userVehicle:{user_id:null,vehicle_id:this.idVehicle}}},methods:u(u(u({},Object(n.d)(["CHANGE_SUBMIT_STATUS","CLEAR_ERRORS"])),Object(n.b)("user",["getUsersDoesntHaveVehicle"])),{},{submit:function(){var e,t=this;return(e=s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.post("/api/users/doesnthave-vehicles",t.userVehicle);case 2:e.sent,t.$emit("save","success");case 4:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function c(e){a(s,n,i,c,o,"next",e)}function o(e){a(s,n,i,c,o,"throw",e)}c(void 0)}))})()}}),computed:u({},Object(n.e)("user",["users"]))},f=r(2),b=Object(f.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[r("b-form-group",{attrs:{label:"ElEGIR CONDUCTOR","label-for":"user_id"}},[r("model-select",{attrs:{options:e.users,placeholder:"Digita el nombre del conductor"},model:{value:e.userVehicle.user_id,callback:function(t){e.$set(e.userVehicle,"user_id",t)},expression:"userVehicle.user_id"}})],1),e._v(" "),r("hr"),e._v(" "),r("div",{staticClass:"text-right"},[r("b-button",{attrs:{variant:"outline-primary",size:"sm"},on:{click:function(t){return e.$bvModal.hide("modal-form-link")}}},[e._v("Cancelar")]),e._v(" "),r("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:e.submit}},[e._v("Asignar")])],1)],1)}),[],!1,null,"72a4a6cc",null).exports;function p(e,t,r,n,i,s,c){try{var o=e[s](c),a=o.value}catch(e){return void r(e)}o.done?t(a):Promise.resolve(a).then(n,i)}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var g={name:"tableUsersLinked",props:["users","idVehicle"],data:function(){return{fields:[{key:"full_name",label:"Nombre del conductor"},{key:"pivot.created_at",label:"Fecha vinculacion"},{key:"actions",label:"Acciones"}]}},methods:m(m({},Object(n.b)("vehicle",["getVehicles"])),{},{showModalDeleteLinkTouser:function(e){var t=this;this.$bvModal.msgBoxConfirm("¿Está seguro que desea eliminar la vinculacion del usuario con el vehiculo?",{size:"sm",buttonSize:"sm",okVariant:"danger",okTitle:"Eliminar",cancelTitle:"NO",footerClass:"p-2",hideHeaderClose:!1,centered:!0}).then((function(r){t.deleteLinktoUser(e).then((function(e){"user unlinked successfully"==e&&(openNotification("Usuario desvinculado corrrectamente","Se ha desvinculado el usuario del Vehiculo"),t.getVehicles(),t.$bvModal.hide("modal-users"))}))}))},deleteLinktoUser:function(e){var t,r=this;return(t=s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.delete("/api/vehicles/".concat(r.idVehicle,"/unlink-user"),e);case 2:return n=t.sent,t.abrupt("return",Promise.resolve(n.data));case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,i){var s=t.apply(e,r);function c(e){p(s,n,i,c,o,"next",e)}function o(e){p(s,n,i,c,o,"throw",e)}c(void 0)}))})()}})};function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k={name:"linkVehicle",components:{formLink:b,tableUsersLinked:Object(f.a)(g,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-table",{attrs:{fields:e.fields,items:e.users,striped:"",hover:"",responsive:""},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[r("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(r){return e.showModalDeleteLinkTouser(t.item.id)}}},[e._v("\n      Eliminar\n    ")])]}}])})}),[],!1,null,"6082589e",null).exports},created:function(){var e=this;this.viewPermissions()||this.$router.push({name:"not-found"}),this.getVehicles(this.search).then((function(t){e.rows=t}))},data:function(){return{currentVehicle:{id:null,car_plate:""},currentUsers:[],search:{page:1,name:""},currentPage:1,perPage:15,rows:0}},methods:_(_({},Object(n.b)("vehicle",["getVehicles","getVehiclesByPlate"])),{},{viewPermissions:function(){return this.abilities.includes("*")||this.abilities.includes("vehiculos-vinculacion")},showModalLinkUser:function(e){this.currentVehicle=e,this.$refs["modal-form-link"].show()},save:function(){openNotification(),this.getVehicles(),this.$refs["modal-form-link"].hide()},showModalUsers:function(e){this.currentUsers=e.users,this.currentVehicle=e,this.$refs["modal-users"].show()},searcByCarPlate:function(){this.getVehicles(this.search)},reset:function(){this.search.name="",this.getVehicles(this.search)}}),computed:_(_({},Object(n.e)("vehicle",["vehicles"])),Object(n.e)("auth",["abilities"])),watch:{currentPage:function(e){this.search.page=e,this.getVehicles(this.search)}}},j=Object(f.a)(k,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-content"},[r("breadcumb",{attrs:{page:"Vinculación",folder:"vehiculos"}}),e._v(" "),r("b-card",{staticClass:"mb-5"},[r("b-row",[r("b-col",{attrs:{md:"8"}},[r("b-form-input",{attrs:{placeholder:"Busca un vehiculo por placa"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),e._v(" "),r("b-col",{attrs:{md:"4"}},[r("b-button",{attrs:{disabled:e.search.name.length<=5,variant:"primary"},on:{click:function(t){return e.searcByCarPlate()}}},[e._v("Buscar")]),e._v(" "),r("b-button",{attrs:{variant:"outline-danger"},on:{click:function(t){return e.reset()}}},[e._v("Resetear")])],1)],1)],1),e._v(" "),r("b-pagination",{attrs:{"total-rows":e.rows,"per-page":e.perPage,"aria-controls":"my-table"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}),e._v(" "),r("b-row",e._l(e.vehicles,(function(t){return r("b-col",{key:t.id,attrs:{lg:"4",md:"4",sm:"6"}},[r("b-card",{staticClass:"card-icon text-center mb-30"},[r("p",{staticClass:"text-primary text-24 mb-2"},[e._v(e._s(t.car_plate))]),e._v(" "),t.users.length?r("b-button",{attrs:{variant:"link",size:"sm"},on:{click:function(r){return e.showModalUsers(t)}}},[e._v("\n          Ver usuarios ("+e._s(t.users_count)+")\n        ")]):e._e(),e._v(" "),r("p",{staticClass:"text-muted line-height-1 mt-2"},[e._v(e._s(t.auto_type))]),e._v(" "),r("i",{staticClass:"i-Add-User clickeable",on:{click:function(r){return e.showModalLinkUser(t)}}})],1)],1)})),1),e._v(" "),r("b-modal",{ref:"modal-form-link",attrs:{centered:"",id:"modal-form-link","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[e._v("\n      Asingar conductor al vehiculo con placa "),r("b",[e._v(e._s(e.currentVehicle.car_plate))])]},proxy:!0}])},[e._v(" "),r("form-link",{attrs:{idVehicle:e.currentVehicle.id},on:{save:e.save}})],1),e._v(" "),r("b-modal",{ref:"modal-users",attrs:{centered:"",id:"modal-users",title:"Desvincular conductores","hide-footer":""}},[r("table-users-linked",{attrs:{users:e.currentUsers,idVehicle:e.currentVehicle.id}})],1)],1)}),[],!1,null,"55673419",null);t.default=j.exports}}]);